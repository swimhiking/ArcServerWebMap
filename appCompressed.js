var layer,baseLayer,map,featureLayer,visible=[],ml=[],toc,surveryPipe,gsvc,pt,googleLayer,swipeWidget,clusterLayer;require(["esri/map","esri/dijit/LayerSwipe","esri/InfoTemplate","esri/dijit/BasemapToggle","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/FeatureLayer","dijit/registry","esri/dijit/Legend","esri/SnappingManager","esri/dijit/Measurement","esri/dijit/Scalebar","esri/units","esri/dijit/BasemapGallery","dojox/layout/ExpandoPane","esri/request","esri/graphic","esri/geometry/Extent","esri/layers/GraphicsLayer","esri/tasks/GeometryService","esri/tasks/ProjectParameters","esri/SpatialReference","esri/dijit/PopupTemplate","esri/geometry/Point","esri/geometry/webMercatorUtils","esri/symbols/SimpleMarkerSymbol","esri/symbols/SimpleFillSymbol","esri/symbols/PictureMarkerSymbol","esri/renderers/ClassBreaksRenderer","esri/Color","agsjs/dijit/TOC","agsjs/layers/GoogleMapsLayer","extras/ClusterLayer","dojo/_base/array","dojo/parser","dojo/dom","dojo/dom-style","dojo/on","dojo/query","dijit/layout/BorderContainer","dijit/layout/ContentPane","dijit/layout/AccordionContainer","extras/proj4js","dojo/domReady!"],function(p,a,D,d,t,Z,af,n,ad,u,F,S,X,J,W,g,L,V,ag,ab,c,B,x,O,ak,b,o,G,s,Y,U,M,f,N,e,ai,Q,ah){N.parse();map=new p("map",{basemap:"topo",center:[-112.0503,58.02028],zoom:6,showLabels:true});var A={title:"Altus Survey Point",content:"Well Name: ${well_name} <br>PDF: ${pdflink} "};var z=new D(A);var l={title:"Surface Well Hole",content:"Well Name: ${wellname}<br> Operation: ${oper} <br>License No: ${license_no} "};var aj=new D(l);var E={title:"Bottom Well Hole",content:"Well Name: ${wellname}<br> Operation: ${oper} <br>License No: ${license_no} "};var q=new D(E);var ac={title:"High Pressure Pipe",content:"License No: ${license}<br> Operation: ${oper} <br>Status: ${status} <br> Substance: ${subst_a} <br>Length: ${length} <br> Wall Thickness: ${wall_thick} <br> Material: ${mat}"};var aa=new D(ac);var P={title:"Altus Survey Pipe",content:"Job Number: ${jobnum}<br>Client: ${client} <br>Name: ${name}"};var w=new D(P);var I={title:"Altus Survey Data",content:"Job Number: ${jobnum}<br>Client: ${client}<br> Name: ${name}"};var r=new D(I);var C=new Z("http://edmsqltest/arcgisadmin/rest/services/Demo_Test/PatTest_Layers/FeatureServer/0",{mode:Z.MODE_ONDEMAND,infoTemplate:z,outFields:["*"]});var y=new Z("http://edmsqltest/arcgisadmin/rest/services/Demo_Test/PatTest_Layers/FeatureServer/1",{mode:Z.MODE_ONDEMAND,infoTemplate:aj,outFields:["*"]});var i=new Z("http://edmsqltest/arcgisadmin/rest/services/Demo_Test/PatTest_Layers/MapServer/2",{mode:Z.MODE_ONDEMAND,infoTemplate:q,outFields:["*"]});var k=new Z("http://edmsqltest/arcgisadmin/rest/services/Demo_Test/PatTest_Layers/MapServer/4",{id:"highpipe",mode:Z.MODE_ONDEMAND,infoTemplate:aa,outFields:["*"]});var v=new Z("http://edmsqltest/arcgisadmin/rest/services/Demo_Test/PatTest_Layers/MapServer/5",{mode:Z.MODE_ONDEMAND,infoTemplate:w,outFields:["*"]});var m=new Z("http://edmsqltest/arcgisadmin/rest/services/Demo_Test/PatTest_Layers/MapServer/6",{mode:Z.MODE_ONDEMAND,infoTemplate:r,outFields:["*"]});var R=new Z("http://edmsqltest/arcgisadmin/rest/services/Demo_Test/PatTest_Layers/MapServer/3",{mode:Z.MODE_ONDEMAND,outFields:["*"]});var ae=new Z("http://edmsqltest/arcgisadmin/rest/services/Demo_Test/PatTest_Layers/MapServer/7",{mode:Z.MODE_ONDEMAND,outFields:["*"]});layer=new t("http://edmsqltest/arcgisadmin/rest/services/Demo_Test/PatTest_Layers/MapServer");baseLayer=new t("http://edmsqltest/arcgisadmin/rest/services/Demo2/AB_Base/MapServer");map.addLayers([C,i,v,m,k,R,y,ae,baseLayer]);map.on("layers-add-result",function(am){toc=new Y({map:map,layerInfos:[{layer:C,title:"Altus Survey Point"},{layer:i,title:"Bottom Wells"},{layer:k,title:"High Pressure Pipe"},{layer:R,title:"Drill Path"},{layer:y,title:"Surface Wells"},{layer:v,title:"Altus Survey Pipe"},{layer:m,title:"Altus Survey Well Polygon"},{layer:ae,title:"Disposition Layer"},{layer:baseLayer,title:"DLS Base Data"},]},"legendDiv");toc.startup();toc.on("load",function(){});toc.on("toc-node-checked",function(ap){if(console){console.log("TOCNodeChecked, rootLayer:"+(ap.rootLayer?ap.rootLayer.id:"NULL")+", serviceLayer:"+(ap.serviceLayer?ap.serviceLayer.id:"NULL")+" Checked:"+ap.checked)}});var an=new u({map:map,defaultAreaUnit:S.SQUARE_METERS,defaultLengthUnit:S.METERS},e.byId("measurementDiv"));an.startup();var ao=new F({map:map,scalebarUnit:"metric"});var al=new esri.dijit.BasemapGallery({showArcGISBasemaps:true,toggleReference:true,google:{apiOptions:{v:"3.6"}},map:map},"basemapGallery");al.startup()});map.on("load",function(){if(map.getZoom()>=10){e.byId("cbxClustering").disabled=false;if(e.byId("cbxClustering").checked){var al=W({url:"functions/sdk/getwelljson.aspx?vp="+map.extent.xmin+","+map.extent.ymin+","+map.extent.xmax+","+map.extent.ymax+"&sr="+map.spatialReference.wkid,handleAs:"json"});al.then(T,K)}}else{e.byId("cbxClustering").disabled=true}});map.on("extent-change",function(){var ao=map.getScale();e.byId("ScaleNum").innerHTML=("<strong>Scale</strong>:&nbsp&nbsp&nbsp1&nbsp&nbsp:&nbsp&nbsp"+ao.toFixed(0)).toString();try{var am=map.getLayer("clusters");map.removeLayer(am)}catch(an){}if(map.getZoom()>=10){e.byId("cbxClustering").disabled=false;if(e.byId("cbxClustering").checked){var al=W({url:"/mapserver2013/vincenttest/functions/sdk/getwelljson.aspx?vp="+map.extent.xmin+","+map.extent.ymin+","+map.extent.xmax+","+map.extent.ymax+"&sr="+map.spatialReference.wkid,handleAs:"json"});al.then(T,K)}}else{e.byId("cbxClustering").disabled=true}});map.on("zoom-end",function(){if(map.getZoom()>=10){if(swipeWidget==null){var al=map.getLayer("layer8");if(al!=null){swipeWidget=new a({type:"vertical",map:map,layers:[al]},"swipeDiv");swipeWidget.startup()}}else{swipeWidget.enable()}}else{try{swipeWidget.disable()}catch(am){}}});function T(aq){var au={};var al=new c({wkid:4326});var an=aq.layers[0].features;au.data=f.map(an,function(aA){var ay=new x(parseFloat(aA.attributes.longitude),parseFloat(aA.attributes.latitude),al);var az=O.geographicToWebMercator(ay);var ax={Name:aA.attributes.well_name,Link:aA.attributes.pdflink};return{x:az.x,y:az.y,attributes:ax}});var av=new B({title:"",fieldInfos:[{fieldName:"Name",label:"Well Name",visible:true},{fieldName:"Link",label:"PDF",visible:true}]});clusterLayer=new M({data:au.data,distance:100,id:"clusters",labelColor:"#fff",labelOffset:10,resolution:map.extent.getWidth()/map.width,singleColor:"#888",singleTemplate:av});var ar=new ak().setSize(4);var at=new G(ar,"clusterCount");var am="http://static.arcgis.com/images/Symbols/Shapes/";var aw=new o(am+"BluePin1LargeB.png",32,32).setOffset(0,15);var ap=new o(am+"GreenPin1LargeB.png",64,64).setOffset(0,15);var ao=new o(am+"RedPin1LargeB.png",72,72).setOffset(0,15);at.addBreak(0,2,aw);at.addBreak(2,200,ap);at.addBreak(200,1001,ao);clusterLayer.setRenderer(at);map.addLayer(clusterLayer);map.reorderLayer(clusterLayer,1);map.on("key-down",function(ax){if(ax.keyCode===27){H()}})}function H(){map.infoWindow.hide();clusterLayer.clearSingles()}function K(al){console.log("something failed: ",al)}function j(am){var ap=O.webMercatorToGeographic(am.mapPoint);var an=new Proj4js.Proj("EPSG:4326");var ar=new Proj4js.Proj("EPSG:3401");var al=new Proj4js.Proj("EPSG:26910");var aq=new Proj4js.Proj("EPSG:26911");var ao=new Proj4js.Proj("EPSG:26912");var at=new Proj4js.Proj("EPSG:26914");e.byId("locationDiv").innerHTML="LatLong (degree)<br><span>Latitude: </span> "+ap.y.toFixed(6)+"<br><span>Longitude:</span>"+ap.x.toFixed(6);e.byId("locationDiv").innerHTML+="<br> 10TM (meter):";h(an,ar,ap.x,ap.y);e.byId("locationDiv").innerHTML+="<br> UTM Zone 10N (meter):";h(an,al,ap.x,ap.y);e.byId("locationDiv").innerHTML+="<br> UTM Zone 11N (meter):";h(an,aq,ap.x,ap.y);e.byId("locationDiv").innerHTML+="<br> UTM Zone 12N (meter):";h(an,ao,ap.x,ap.y);e.byId("locationDiv").innerHTML+="<br> UTM Zone 14N (meter):";h(an,at,ap.x,ap.y)}function h(ao,an,am,ap){var al=new Proj4js.Point(am,ap);Proj4js.transform(ao,an,al);e.byId("locationDiv").innerHTML+="<br><span>X: </span>"+al.x.toFixed(2)+"<br><span>Y: </span>"+al.y.toFixed(2)}map.on("mouse-move",j);e.byId("btnZoomtosec").onclick=function(){var aq=document.getElementById("txtSec").value;if(aq==""||aq==null){aq=0}var ao=document.getElementById("txtTwp").value;var am=document.getElementById("txtRge").value;var ap=document.getElementById("txtMer").value.replace(/m/g,"").replace(/M/g,"");if(!isNaN(aq)&&!isNaN(ao)&&!isNaN(am)&&!isNaN(ap)){var al="sec="+aq+"&twp="+ao+"&rge="+am+"&mer="+ap;var ar={url:"/mapserver2013/vincenttest/functions/sdk/getlandgridextent.aspx?"+al,handleAs:"json",load:function(au){if(au!=null){var at=new esri.geometry.Extent(au);map.setExtent(at)}else{alert("Cannot locate the land grid")}},error:function(at){alert("Cannot locate the land grid")}};var an=dojo.xhrGet(ar)}else{alert("Please check your input and try it again.")}};e.byId("cbxClustering").onclick=function(){try{var al=map.getLayer("clusters");if(document.getElementById("cbxClustering").checked){}else{al.visible=false}map.setExtent(map.extent.offset(0.0001,0))}catch(am){alert(am)}}});